(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function s(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerpolicy&&(o.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?o.credentials="include":i.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=s(i);fetch(i.href,o)}})();const Z=!1,tt=(e,t)=>e===t,N={equals:tt};let M=G;const x=1,R=2,W={owned:null,cleanups:null,context:null,owner:null};var p=null;let T=null,et=null,d=null,g=null,w=null,F=0;function st(e,t){const s=d,n=p,i=e.length===0,o=t===void 0?n:t,r=i?W:{owned:null,cleanups:null,context:o?o.context:null,owner:o},l=i?e:()=>e(()=>A(()=>E(r)));p=r,d=null;try{return L(l,!0)}finally{d=s,p=n}}function O(e,t){t=t?Object.assign({},N,t):N;const s={value:e,observers:null,observerSlots:null,comparator:t.equals||void 0},n=i=>(typeof i=="function"&&(i=i(s.value)),k(s,i));return[nt.bind(s),n]}function B(e,t,s){const n=j(e,t,!1,x);U(n)}function H(e,t,s){M=rt;const n=j(e,t,!1,x);(!s||!s.render)&&(n.user=!0),w?w.push(n):U(n)}function A(e){if(d===null)return e();const t=d;d=null;try{return e()}finally{d=t}}function it(e){H(()=>A(e))}function nt(){if(this.sources&&this.state)if(this.state===x)U(this);else{const e=g;g=null,L(()=>I(this),!1),g=e}if(d){const e=this.observers?this.observers.length:0;d.sources?(d.sources.push(this),d.sourceSlots.push(e)):(d.sources=[this],d.sourceSlots=[e]),this.observers?(this.observers.push(d),this.observerSlots.push(d.sources.length-1)):(this.observers=[d],this.observerSlots=[d.sources.length-1])}return this.value}function k(e,t,s){let n=e.value;return(!e.comparator||!e.comparator(n,t))&&(e.value=t,e.observers&&e.observers.length&&L(()=>{for(let i=0;i<e.observers.length;i+=1){const o=e.observers[i],r=T&&T.running;r&&T.disposed.has(o),(r?!o.tState:!o.state)&&(o.pure?g.push(o):w.push(o),o.observers&&z(o)),r||(o.state=x)}if(g.length>1e6)throw g=[],new Error},!1)),t}function U(e){if(!e.fn)return;E(e);const t=F;ot(e,e.value,t)}function ot(e,t,s){let n;const i=p,o=d;d=p=e;try{n=e.fn(t)}catch(r){return e.pure&&(e.state=x,e.owned&&e.owned.forEach(E),e.owned=null),e.updatedAt=s+1,Q(r)}finally{d=o,p=i}(!e.updatedAt||e.updatedAt<=s)&&(e.updatedAt!=null&&"observers"in e?k(e,n):e.value=n,e.updatedAt=s)}function j(e,t,s,n=x,i){const o={fn:e,state:n,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:p,context:p?p.context:null,pure:s};return p===null||p!==W&&(p.owned?p.owned.push(o):p.owned=[o]),o}function q(e){if(e.state===0)return;if(e.state===R)return I(e);if(e.suspense&&A(e.suspense.inFallback))return e.suspense.effects.push(e);const t=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<F);)e.state&&t.push(e);for(let s=t.length-1;s>=0;s--)if(e=t[s],e.state===x)U(e);else if(e.state===R){const n=g;g=null,L(()=>I(e,t[0]),!1),g=n}}function L(e,t){if(g)return e();let s=!1;t||(g=[]),w?s=!0:w=[],F++;try{const n=e();return lt(s),n}catch(n){s||(w=null),g=null,Q(n)}}function lt(e){if(g&&(G(g),g=null),e)return;const t=w;w=null,t.length&&L(()=>M(t),!1)}function G(e){for(let t=0;t<e.length;t++)q(e[t])}function rt(e){let t,s=0;for(t=0;t<e.length;t++){const n=e[t];n.user?e[s++]=n:q(n)}for(t=0;t<s;t++)q(e[t])}function I(e,t){e.state=0;for(let s=0;s<e.sources.length;s+=1){const n=e.sources[s];if(n.sources){const i=n.state;i===x?n!==t&&(!n.updatedAt||n.updatedAt<F)&&q(n):i===R&&I(n,t)}}}function z(e){for(let t=0;t<e.observers.length;t+=1){const s=e.observers[t];s.state||(s.state=R,s.pure?g.push(s):w.push(s),s.observers&&z(s))}}function E(e){let t;if(e.sources)for(;e.sources.length;){const s=e.sources.pop(),n=e.sourceSlots.pop(),i=s.observers;if(i&&i.length){const o=i.pop(),r=s.observerSlots.pop();n<i.length&&(o.sourceSlots[r]=n,i[n]=o,s.observerSlots[n]=r)}}if(e.tOwned){for(t=e.tOwned.length-1;t>=0;t--)E(e.tOwned[t]);delete e.tOwned}if(e.owned){for(t=e.owned.length-1;t>=0;t--)E(e.owned[t]);e.owned=null}if(e.cleanups){for(t=e.cleanups.length-1;t>=0;t--)e.cleanups[t]();e.cleanups=null}e.state=0}function at(e){return e instanceof Error?e:new Error(typeof e=="string"?e:"Unknown error",{cause:e})}function Q(e,t=p){throw at(e)}function _(e,t){return A(()=>e(t||{}))}function ct(e,t,s){let n=s.length,i=t.length,o=n,r=0,l=0,a=t[i-1].nextSibling,u=null;for(;r<i||l<o;){if(t[r]===s[l]){r++,l++;continue}for(;t[i-1]===s[o-1];)i--,o--;if(i===r){const h=o<n?l?s[l-1].nextSibling:s[o-l]:a;for(;l<o;)e.insertBefore(s[l++],h)}else if(o===l)for(;r<i;)(!u||!u.has(t[r]))&&t[r].remove(),r++;else if(t[r]===s[o-1]&&s[l]===t[i-1]){const h=t[--i].nextSibling;e.insertBefore(s[l++],t[r++].nextSibling),e.insertBefore(s[--o],h),t[i]=s[o]}else{if(!u){u=new Map;let c=l;for(;c<o;)u.set(s[c],c++)}const h=u.get(t[r]);if(h!=null)if(l<h&&h<o){let c=r,m=1,f;for(;++c<i&&c<o&&!((f=u.get(t[c]))==null||f!==h+m);)m++;if(m>h-l){const C=t[r];for(;l<h;)e.insertBefore(s[l++],C)}else e.replaceChild(s[l++],t[r++])}else r++;else t[r++].remove()}}}function ht(e,t,s,n={}){let i;return st(o=>{i=o,t===document?e():V(t,e(),t.firstChild?null:void 0,s)},n.owner),()=>{i(),t.textContent=""}}function J(e,t,s,n){let i;const o=()=>{const l=n?document.createElementNS("http://www.w3.org/1998/Math/MathML","template"):document.createElement("template");return l.innerHTML=e,s?l.content.firstChild.firstChild:n?l.firstChild:l.content.firstChild},r=t?()=>A(()=>document.importNode(i||(i=o()),!0)):()=>(i||(i=o())).cloneNode(!0);return r.cloneNode=r,r}function V(e,t,s,n){if(s!==void 0&&!n&&(n=[]),typeof t!="function")return D(e,t,n,s);B(i=>D(e,t(),i,s),n)}function D(e,t,s,n,i){for(;typeof s=="function";)s=s();if(t===s)return s;const o=typeof t,r=n!==void 0;if(e=r&&s[0]&&s[0].parentNode||e,o==="string"||o==="number"){if(o==="number"&&(t=t.toString(),t===s))return s;if(r){let l=s[0];l&&l.nodeType===3?l.data!==t&&(l.data=t):l=document.createTextNode(t),s=y(e,s,n,l)}else s!==""&&typeof s=="string"?s=e.firstChild.data=t:s=e.textContent=t}else if(t==null||o==="boolean")s=y(e,s,n);else{if(o==="function")return B(()=>{let l=t();for(;typeof l=="function";)l=l();s=D(e,l,s,n)}),()=>s;if(Array.isArray(t)){const l=[],a=s&&Array.isArray(s);if(P(l,t,s,i))return B(()=>s=D(e,l,s,n,!0)),()=>s;if(l.length===0){if(s=y(e,s,n),r)return s}else a?s.length===0?$(e,l,n):ct(e,s,l):(s&&y(e),$(e,l));s=l}else if(t.nodeType){if(Array.isArray(s)){if(r)return s=y(e,s,n,t);y(e,s,null,t)}else s==null||s===""||!e.firstChild?e.appendChild(t):e.replaceChild(t,e.firstChild);s=t}}return s}function P(e,t,s,n){let i=!1;for(let o=0,r=t.length;o<r;o++){let l=t[o],a=s&&s[e.length],u;if(!(l==null||l===!0||l===!1))if((u=typeof l)=="object"&&l.nodeType)e.push(l);else if(Array.isArray(l))i=P(e,l,a)||i;else if(u==="function")if(n){for(;typeof l=="function";)l=l();i=P(e,Array.isArray(l)?l:[l],Array.isArray(a)?a:[a])||i}else e.push(l),i=!0;else{const h=String(l);a&&a.nodeType===3&&a.data===h?e.push(a):e.push(document.createTextNode(h))}}return i}function $(e,t,s=null){for(let n=0,i=t.length;n<i;n++)e.insertBefore(t[n],s)}function y(e,t,s,n){if(s===void 0)return e.textContent="";const i=n||document.createTextNode("");if(t.length){let o=!1;for(let r=t.length-1;r>=0;r--){const l=t[r];if(i!==l){const a=l.parentNode===e;!o&&!r?a?e.replaceChild(i,l):e.insertBefore(i,s):a&&l.remove()}else o=!0}}else e.insertBefore(i,s);return[i]}const K=10;class X{r;g;b;a;constructor(t,s,n,i=1){this.r=t,this.g=s,this.b=n,this.a=i}toString(){return`rgb(${this.r}, ${this.g}, ${this.b})`}}class S{x;y;radius;color;ctx;imageCtx;quadrant;coolDown=!1;constructor(t,s,n,i,o,r){this.x=t,this.y=s,this.radius=n,this.color=i,this.ctx=o,this.imageCtx=r,this.quadrant=this.getQuadrant.bind(this)}async draw(){await this.quadrantBlack();let t=this.ctx.canvas.width,s=this.ctx.canvas.height,n=this.x*t+t/2,i=this.y*s+s/2,o=this.radius*t;this.ctx.beginPath(),this.ctx.arc(n,i,o,0,2*Math.PI),this.ctx.fillStyle=this.color.toString(),this.ctx.fill(),this.ctx.closePath()}getQuadrant(){let t=this.x-this.radius,s=this.x+this.radius,n=this.y-this.radius,i=this.y+this.radius;return{xmin:t,xmax:s,ymin:n,ymax:i}}getColorFromXY(t,s,n){let i=this.ctx.canvas.width,o=this.ctx.canvas.height;t=t*i+i/2,s=s*o+o/2;let r=n.getImageData(t,s,1,1);return`rgb(${r?.data[0]}, ${r?.data[1]}, ${r?.data[2]})`}changeColor(t){this.color=t,this.draw()}async quadrantBlack(){let t=this.ctx.canvas.width,s=this.quadrant;this.ctx.fillStyle="black";let n={xmin:Math.floor(s().xmin*t+t/2),xmax:Math.ceil(s().xmax*t+t/2),ymin:Math.floor(s().ymin*t+t/2),ymax:Math.ceil(s().ymax*t+t/2)};this.ctx.fillRect(n.xmin,n.ymin,n.xmax-n.xmin,n.ymax-n.ymin)}beginCoolDown(){this.coolDown=!0,setTimeout(()=>{this.coolDown=!1},K*30)}}class Y{circles=[];canvas;pictureCanvas;image;ctx;width;height;mouseSignal;mousePos;animation=O(!1);disabled=!1;constructor(t,s){let n=innerWidth>innerHeight?innerHeight/2:innerWidth/2;window.circles=this.circles,this.pictureCanvas=document.createElement("canvas");let i=this.pictureCanvas.getContext("2d",{willReadFrequently:!0});this.pictureCanvas.width=n*2,this.pictureCanvas.height=n*2,this.image=s,this.mouseSignal=O({x:0,y:0}),this.mousePos=this.mouseSignal[0],this.width=this.getWidth,this.height=this.getWidth;let o=t;this.canvas=o,this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0}),this.canvas.width=n*2,this.canvas.height=n*2,s.onload=async()=>{i?.drawImage(s,0,0,n*2,n*2);let r=new S(0,0,.5,this.getColorFromXY(0,0,i),this.ctx,i);this.circles.push(r),await this.drawAllCircles()},this.addEventListeners()}async drawAllCircles(){if(!this.disabled)for(let t=0;t<this.circles.length;t++)await this.circles[t].draw()}getWidth(){return this.disabled?void 0:(innerWidth>innerHeight?innerHeight/2:innerWidth/2)*2}addEventListeners(){this.disabled||(this.canvas.addEventListener("mousemove",t=>{if(this.disabled)return;let s=this.canvas.getBoundingClientRect();console.log(s);let n=s.left,i=s.top,o=(t.clientX-n-this.width()/2)/this.width(),r=(t.clientY-i-this.width()/2)/this.width();this.mouseSignal[1]({x:o,y:r}),this.mousePos()}),this.canvas.addEventListener("touchmove",t=>{if(this.disabled)return;let s=this.canvas.getBoundingClientRect(),n=s.left,i=s.top,o=(t.touches[0].clientX-n-this.width()/2)/this.width(),r=(t.touches[0].clientY-i-this.width()/2)/this.width();this.mouseSignal[1]({x:o,y:r}),this.mousePos()}),window.addEventListener("resize",()=>{if(this.disabled)return;let t=this.width();this.canvas.width=t,this.canvas.height=t,this.pictureCanvas.width=t,this.pictureCanvas.height=t;let s=this.pictureCanvas.getContext("2d",{willReadFrequently:!0});this.canvas.getContext("2d",{willReadFrequently:!0}),s?.drawImage(this.image,0,0,t,t),this.drawAllCircles()}),this.checkHover())}getColorFromXY(t,s,n){let i=n.canvas.width,o=n.canvas.height;t=t*i+i/2,s=s*i+o/2;let r=n.getImageData(t,s,1,1);return new X(r?.data[0],r?.data[1],r?.data[2])}checkHover(){this.disabled||H(async()=>{if(this.disabled)return;let t=this.mousePos().x,s=this.mousePos().y;if(this.circles.length>0)for(let n=0;n<this.circles.length;n++){let i=this.circles[n];if(i.coolDown!=!0&&t>=i.quadrant().xmin&&t<=i.quadrant().xmax&&s>=i.quadrant().ymin&&s<=i.quadrant().ymax){let o=(t-i.x)*(t-i.x)+(s-i.y)*(s-i.y),r=i.radius*i.radius;o<=r?await this.animateCircleSplit(i,this.ctx):i.changeColor(this.getColorFromXY(i.x,i.y,i.imageCtx))}}})}async animateCircleSplit(t,s){if(this.disabled||t.radius<=.004||t.coolDown===!0)return;t.quadrantBlack();let n=t.radius,i=n/40,o=t.x,r=t.y,l=new S(o,r,n,this.getColorFromXY(o,r,t.imageCtx),s,t.imageCtx),a=new S(o,r,n,this.getColorFromXY(o,r,t.imageCtx),s,t.imageCtx),u=new S(o,r,n,this.getColorFromXY(o,r,t.imageCtx),s,t.imageCtx);t.beginCoolDown(),l.beginCoolDown(),a.beginCoolDown(),u.beginCoolDown(),this.circles.push(l),this.circles.push(a),this.circles.push(u),console.log("original radius",n);for(let h=0;h<=20;h++){await t.quadrantBlack();let c=n-h*i;t.radius=c,t.x=o-h*i,t.y=r-h*i,t.changeColor(this.getColorFromXY(t.x,t.y,t.imageCtx)),l.radius=c,l.x=o+h*i,l.y=r-h*i,l.changeColor(this.getColorFromXY(l.x,l.y,l.imageCtx)),a.radius=c,a.x=o-h*i,a.y=r+h*i,a.changeColor(this.getColorFromXY(a.x,a.y,a.imageCtx)),u.radius=c,u.x=o+h*i,u.y=r+h*i,u.changeColor(this.getColorFromXY(u.x,u.y,u.imageCtx)),await t.draw(),await new Promise(m=>setTimeout(m,K))}}exportCirclesData(t="circles-data.json"){if(this.disabled)return;const s=c=>Math.round((c+1)*125),n=c=>(c+1)*125,i=c=>Math.max(1,Math.round(c*125)),o=c=>c*125,r={timestamp:new Date().toISOString(),canvasSize:{width:this.canvas.width,height:this.canvas.height,virtualSize:{min:-1,max:1},gridSize:{width:250,height:250}},circleCount:this.circles.length,minRadius:.004,coordinateSystem:"Grid-based: (0,0) = top-left, max = (250,250)",circles:this.circles.map(c=>({normalized:{x:c.x,y:c.y,radius:c.radius},grid:{x:s(c.x),y:s(c.y),radius:i(c.radius)},gridPrecise:{x:n(c.x),y:n(c.y),radius:o(c.radius)},color:{r:c.color.r,g:c.color.g,b:c.color.b,a:c.color.a},coolDown:c.coolDown}))},l=JSON.stringify(r,null,2),a=new Blob([l],{type:"application/json"}),u=URL.createObjectURL(a),h=document.createElement("a");return h.href=u,h.download=t,document.body.appendChild(h),h.click(),document.body.removeChild(h),URL.revokeObjectURL(u),console.log(`Exported ${this.circles.length} circles to ${t}`),r}importCirclesData(t){if(!this.disabled)try{this.circles=[],t.circles.forEach(s=>{const n=new X(s.color.r,s.color.g,s.color.b,s.color.a),i=new S(s.x,s.y,s.radius,n,this.ctx,this.pictureCanvas.getContext("2d",{willReadFrequently:!0}));i.coolDown=s.coolDown,this.circles.push(i)}),this.drawAllCircles(),console.log(`Imported ${this.circles.length} circles`)}catch(s){console.error("Error importing circles data:",s)}}}var ut=J("<div class=dots><div class=controls><div class=upload>Upload</div><div class=export>Export</div></div><canvas>");function dt({}){let e=null;it(async()=>{let i=document.querySelector("canvas"),o=await s();e=new Y(i,o),t()});function t(){document.querySelector(".upload").addEventListener("click",()=>{n(e)});let o=document.querySelector(".export");o?(o.addEventListener("click",()=>{if(console.log("Export button clicked, circlesInstance:",e),e){console.log("About to export, circles count:",e.circles.length);try{e.exportCirclesData(`circles-export-${Date.now()}.json`),console.log("Export completed successfully")}catch(r){console.error("Export failed:",r)}}else console.error("Circles instance is null")}),console.log("Export button event listener added")):console.error("Export button not found")}async function s(){const i=`https://api.allorigins.win/get?url=${encodeURIComponent("https://api.thecatapi.com/v1/images/search")}`;console.log(i);let o="";await fetch(i).then(b=>b.json()).then(b=>{b=JSON.parse(b.contents),o=b[0].url});const l=await(await fetch("https://corsproxy.io/?"+encodeURIComponent(o))).blob(),a=await createImageBitmap(l),u=document.createElement("canvas"),h=u.getContext("2d");if(!h)throw new Error("Could not get canvas context");u.width=4e3,u.height=4e3;let c,m,f;a.width>a.height?(f=a.height,c=(a.width-f)/2,m=0):(f=a.width,c=0,m=(a.height-f)/2),h.drawImage(a,c,m,f,f,0,0,4e3,4e3);const C=u.toDataURL(),v=document.createElement("img");return v.src=C,v}async function n(i){let o=document.createElement("input");o.type="file",o.accept="image/*",o.click(),o.addEventListener("change",async()=>{if(!o.files||o.files.length===0)return;let r=o.files[0],l=new FileReader;l.readAsDataURL(r),l.onload=async()=>{let a=new Image;a.src=l.result,a.onload=()=>{let u=document.querySelector("canvas"),h=u.getContext("2d");if(!h)return;u.width=500,u.height=500;let c,m,f;a.width>a.height?(f=a.height,c=(a.width-f)/2,m=0):(f=a.width,c=0,m=(a.height-f)/2),h.drawImage(a,c,m,f,f,0,0,500,500);const C=u.toDataURL(),v=document.createElement("img");v.src=C,i.disabled=!0,e=new Y(u,v)}}})}return ut()}var ft=J("<div class=app-container>");const gt=()=>(()=>{var e=ft();return V(e,_(dt,{})),e})();ht(()=>_(gt,{}),document.getElementById("root"));
